import matplotlib.pyplot as plt
import numpy as np

stats_small = [
    (4096, 25, 9.958834126982453e-05, 0.00014758827000031625),
    (4096, 50, 0.00010781968051949074, 0.00014878691000041577),
    (4096, 100, 0.00010573883135701917, 0.0001452002099986059),
    (4096, 200, 9.880864295775933e-05, 0.00011897984999967206),
    (4096, 500, 9.71850021364178e-05, 0.00012701259999950304),
    (4096, 750, 0.000104333006604882, 0.00017221317999936055),
    (4096, 1000, 7.158077357894258e-05, 0.00010492464000016362),
    (16384, 25, 9.703922311829393e-05, 0.00012757934999914512),
    (16384, 50, 0.00010647201484486456, 0.00014197040000034643),
    (16384, 100, 0.00011135134806252035, 0.0006661558000002834),
    (16384, 200, 9.860158056792025e-05, 0.00011915642000104754),
    (16384, 500, 8.963848890532113e-05, 0.00011832228000016265),
    (16384, 750, 9.70882969057193e-05, 0.00011612566000005482),
    (16384, 1000, 7.106076593307437e-05, 0.00010209781999883216),
    (32768, 25, 9.399907068066777e-05, 0.00012750612999973043),
    (32768, 50, 9.533842332895207e-05, 0.00013645464000036964),
    (32768, 100, 9.851174766979141e-05, 0.0001392952499995115),
    (32768, 200, 9.761883572620566e-05, 0.00011801504000128913),
    (32768, 500, 9.249619667590751e-05, 0.00012325729999994341),
    (32768, 750, 0.00010020573310337581, 0.00011804039999944392),
    (32768, 1000, 7.246720213189027e-05, 0.00010753950000017551)
]
stats_big = [
    (262144, 200, 0.00010298847468993089, 0.00013997776000000068),
    (262144, 500, 9.362192851617537e-05, 0.0001281589999994104),
    (262144, 750, 9.96387325896162e-05, 0.00013348696000029753),
    (262144, 1000, 7.038272590336829e-05, 0.00010237060000051208),
    (262144, 1500, 5.6085042506605104e-05, 6.879520000060423e-05),
    (262144, 2000, 5.280457193854845e-05, 6.526603000001074e-05),
    (1048576, 200, 9.746567120893436e-05, 0.00013258379000069092),
    (1048576, 500, 9.86210409577017e-05, 0.0001373087999994028),
    (1048576, 750, 9.844123974763681e-05, 0.00013280099000072983),
    (1048576, 1000, 7.215711097128446e-05, 0.00010633984000001826),
    (1048576, 1500, 5.496373779094126e-05, 6.826647999999656e-05),
    (1048576, 2000, 5.189170959913311e-05, 6.395359999942229e-05),
    (8388608, 200, 0.00010231525588536586, 0.00013907630000087318),
    (8388608, 500, 9.467247583864644e-05, 0.0001311593999997385),
    (8388608, 750, 9.939796918305788e-05, 0.000137602590000192),
    (8388608, 1000, 7.234830555786127e-05, 0.00010419724000065855),
    (8388608, 1500, 5.4596987829724266e-05, 6.975029999856553e-05),
    (8388608, 2000, 5.362895054320008e-05, 6.636995999961932e-05),
    (33554432, 200, 0.00011054918694886226, 0.00014352331999894816),
    (33554432, 500, 9.68696655462164e-05, 0.0001328773600008048),
    (33554432, 750, 9.752165211809524e-05, 0.00013176795000024622),
    (33554432, 1000, 7.327154878439761e-05, 0.00010779805000032278),
    (33554432, 1500, 5.461207905803068e-05, 6.753135999936434e-05),
    (33554432, 2000, 5.0645680327863646e-05, 6.621476000008282e-05)
 ]

def plot_stats(stats, name):
    measurements = {}
    for size, x, y1, y2 in stats:
        if size in measurements:
            measurements[size][0].append(x)
            measurements[size][1].append(y1)
            measurements[size][2].append(y2)
        else:
            measurements[size] = ([], [], [])

    colors = ['#cd853f', '#7cfc00', '#00bfff', '#9400d3', '#a52a2a', '#cd5c5c', '#00ff7f', 'orange', '#bdb76b', 'yellow']
    i = 0
    fig, ax = plt.subplots(figsize=(6, 4))

    for key, (x, y1, y2) in measurements.items():
        ax.plot(x, y1, label=f'mean {key//1024}KB', color=colors[i], linestyle='--')
        ax.plot(x, y2, label=f'p99 {key//1024}KB', color=colors[i])
        ax.scatter(x, y2, color='black')
        i += 1
    ax.set_title(f'Respond time depending on frequency and size of ring buffer')
    ax.legend()
    ax.grid()
    ax.set_ylabel('respond duration, seconds')
    ax.set_xlabel('messages per second')
    plt.savefig(name)
    print(f'Saved plot to {name}...')
    plt.close()

plot_stats(stats_small, 'img/stats_small.png')
plot_stats(stats_big, 'img/stats_big.png')
